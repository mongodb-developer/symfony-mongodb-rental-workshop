"use strict";(self.webpackChunksymfony_mongodb_atlas_workshop=self.webpackChunksymfony_mongodb_atlas_workshop||[]).push([[19],{244:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>a,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=t(4848),l=t(8453);const s={},r="\ud83d\udce6 Deploying the workshop",i={id:"deploy-the-workshop",title:"\ud83d\udce6 Deploying the workshop",description:"Platform.sh",source:"@site/docs/60-deploy-the-workshop.mdx",sourceDirName:".",slug:"/deploy-the-workshop",permalink:"/symfony-mongodb-rental-workshop/docs/deploy-the-workshop",draft:!1,unlisted:!1,editUrl:"https://github.com/mongodb-developer/symfony-mongodb-rental-workshop/blob/main/docs/60-deploy-the-workshop.mdx",tags:[],version:"current",sidebarPosition:60,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u2728 Create rentals and List a specific rental",permalink:"/symfony-mongodb-rental-workshop/docs/testing/test-create-details-booking"},next:{title:"\ud83c\udfaf Summary",permalink:"/symfony-mongodb-rental-workshop/docs/summary"}},a={},c=[{value:"Platform.sh",id:"platformsh",level:2},{value:"CLI Installation of our project",id:"cli-installation-of-our-project",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Init the project",id:"init-the-project",level:3},{value:"Setup the project fields",id:"setup-the-project-fields",level:3},{value:"Add secrets",id:"add-secrets",level:3},{value:"Deploy the project",id:"deploy-the-project",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2}];function h(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.h1,{id:"-deploying-the-workshop",children:"\ud83d\udce6 Deploying the workshop"}),"\n",(0,n.jsx)(o.h2,{id:"platformsh",children:"Platform.sh"}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.a,{href:"https://platform.sh/",children:"Platform.sh"})," is a Platform as a Service (PaaS) that allows you to host, build, and scale applications in the cloud. It is a nice tool to deploy and manage your ",(0,n.jsx)(o.a,{href:"https://symfony.com/cloud/",children:"Symfony"}),"  applications."]}),"\n",(0,n.jsx)(o.h2,{id:"cli-installation-of-our-project",children:"CLI Installation of our project"}),"\n",(0,n.jsxs)(o.p,{children:["We will follow the guide on Symfony website to ",(0,n.jsx)(o.a,{href:"https://docs.platform.sh/guides/symfony/get-started",children:"deploy"})," an exsiting project on Platform.sh."]}),"\n",(0,n.jsx)(o.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"Git"}),"\n",(0,n.jsx)(o.li,{children:"Symfony CLI"}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://docs.platform.sh/administration/cli.html#cli-command-line-interface",children:"Platform.sh CLI"})}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Authenticate to Platform.sh"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"platform\n"})}),"\n",(0,n.jsx)(o.h3,{id:"init-the-project",children:"Init the project"}),"\n",(0,n.jsx)(o.p,{children:"In our root directory we will run the following command to initialize the project:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"symfony project:init\n"})}),"\n",(0,n.jsx)(o.h3,{id:"setup-the-project-fields",children:"Setup the project fields"}),"\n",(0,n.jsx)(o.p,{children:"First we will edit the needed files to deploy"}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.strong,{children:".platform.app.yaml"})}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-yaml",children:"name: app\n\ntype: php:8.2\n\nruntime:\n    extensions:\n        - apcu\n        - mbstring\n        - sodium\n        - ctype\n        - iconv\n        - mongodb  \n        \n"})}),"\n",(0,n.jsx)(o.p,{children:"Add to a local git in order to be able to push the project to Platform.sh"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'git add .platform.app.yaml .platform/services.yaml .platform/routes.yaml php.ini\ngit commit -m "Add Platform.sh configuration"\n'})}),"\n",(0,n.jsx)(o.h3,{id:"add-secrets",children:"Add secrets"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"platform variable:create --name env:MONGODB_URL --value '<ATLAS_URI>' --sensitive true\nplatform variable:create --name env:MONGODB_DB --value 'symfony'\n"})}),"\n",(0,n.jsx)(o.h3,{id:"deploy-the-project",children:"Deploy the project"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"symfony deploy\n"})}),"\n",(0,n.jsx)(o.p,{children:"This will ask for you to select the project and the environment to deploy to. Once its selected the prompt will ask to confirm if you want to push the current git HEAD into the project."}),"\n",(0,n.jsx)(o.p,{children:"The deployment will take a few minutes to complete. Once it is done, you will be able to access the published URL on the cloud."}),"\n",(0,n.jsx)(o.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,n.jsx)(o.p,{children:"To view the logs you can :"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Use the command line"}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"symfony log app --tail\n"})}),"\n",(0,n.jsxs)(o.ol,{start:"2",children:["\n",(0,n.jsx)(o.li,{children:"SSH into your cloud pod:"}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:" platform ssh -e  <ENVIRONMENT_NAME> \n\n app> tail -f /var/log/app.log\n"})}),"\n",(0,n.jsx)(o.h1,{id:"-conclusion",children:"\ud83d\udce6 Conclusion"}),"\n",(0,n.jsx)(o.p,{children:"In this workshop we have seen how to deploy a Symfony application to the cloud using Platform.sh. We have seen how to create a new project, how to create a new MongoDB database and how to deploy the project to the cloud. We have also seen how to troubleshoot the deployment and how to access the logs of the application."})]})}function d(e={}){const{wrapper:o}={...(0,l.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,o,t)=>{t.d(o,{R:()=>r,x:()=>i});var n=t(6540);const l={},s=n.createContext(l);function r(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);